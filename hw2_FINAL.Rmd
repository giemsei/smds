---
title: "GroupG_HM2"
author: "Michele Alessi, Gianmarco Alessio, Gabriele Codega, Leonardo Musini"
date: "2022-11-21"
output:
  html_document:
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## FSDS - Chapter 3

### Ex 3.12

Simulate a random sampling from a normal population distribution with several $n$ values to illustrate the law of large numbers.

**Solution**

We want to simulate a sample of $n=10$,$n=1000$,$n=1000000$ (the number of datasets to be simulated) and we generate an outcome ($\overline{y}$) with a normal population distribution of $mean=50$ and $var=10$. We took the mean of this outcomes for each 3 cases and to prove the law of large numbers we used *the convergence in probability* of $\overline{y}$ to $\mu$ for $n\to\infty$.

```{r}
set.seed(11)
mean(rnorm(10,50,10));
mean(rnorm(10^3, 50, 10));
mean(rnorm(10^7,50,10))
```

As we can see the mean converge to $\mu=50$ as $n$ increase.

### Ex. 3.28

A survey is planned to estimate the population proportion $\pi$ supporting more government action to address global warming. For a simple random sample, if $\pi$ may be near 0.50, how large should n be so that the standard error of the sample proportion is 0.04?

**Solution**

The standard error for a proportion is 
$$
SE(\hat\pi) = \sqrt{\frac{\hat\pi(1-\hat\pi)}{n}}
$$

By solving for $n$ we can determine how big the sample should be in order to obtain a standard error equal to 0.04.
$$
n = \frac{\hat\pi (1-\hat\pi)}{SE^2} = \frac{0.5^2}{0.04^2}= 156
$$


## FSDS - Chapter 4
### EX. 4.44
Refer to the previous two exercises. Consider the selling prices (in thousands of dollars) in the `Houses` data file mentioned in Exercise 4.31.
(a) Fit the normal distribution to the data by finding the ML estimates of $\mu$ and $\sigma$ for that distribution.
(b) Fit the log-normal distribution to the data by finding the ML estimates of its parameters.
(c) Find and compare the ML estimates of the mean and standard deviation of selling price for the two distributions.
(d) Superimpose the fitted normal and log-normal distributions on a histogram of the data. Which distribution seems to be more appropriate for summarizing the selling prices?

**Solution**

(a) The ML estimates for $\mu$ and $\sigma$ are 
$$
\hat\mu = \frac{\sum_{i=1}^n y_i}{n}\\
\hat\sigma=\sqrt\frac{\sum_{i=1}^n (y_i-\hat\mu)^2}{n}
$$
We evaluate them as
```{r}
library(MASS)
df <- read.table("./Houses.dat.txt", header=TRUE, 
   sep="")
prices<-df$price

mu_n<-mean(prices)
sigma_n<-sqrt(sum((prices-mu_n)^2)/length(prices))
mu_n
sigma_n
```

(b) For the lognormal distribution the estimates are
$$
\hat\mu = \frac{\sum_{i=1}^n \log y_i}{n}\\
\hat\sigma=\sqrt\frac{\sum_{i=1}^n (\log y_i-\hat\mu)^2}{n}
$$
We evaluate them as
```{r}
log_prices<-log(prices)
mu_ln<-mean(log_prices)
sigma_ln<-sqrt(sum((log_prices-mu_ln)^2)/length(log_prices))
mu_ln
sigma_ln
```

(c) For the normal distribution, the mean and variance of $Y$ are the parameters estimated in point (a), while the mean and variance for the lognormal distribution are
$$
E[Y] = e^{\mu+\sigma^2/2} \qquad var[Y]=(e^{\sigma^2}-1)E[Y]^2
$$
Using the estimates provided in (b), we get the values
```{r}
exp(mu_ln+sigma_ln^2/2) #mean
sqrt((exp(sigma_ln^2)-1))*exp(mu_ln+sigma_ln^2/2) #sd
```
and we observe that while the means are very similar, the lognormal standard deviation is smaller.

(d) We plot the histogram for the data and the distributions obtain with the estimated parameters and observe that the lognormal distribution (in red) seems to be in greater agreement with the data.
```{r}
hist.scott(prices,main="")
curve( dnorm(x,mu_n,sigma_n),add=T)
curve( dlnorm(x,mu_ln,sigma_ln),add=T, col=2)
```


### Ex 4.48

For a simple random sample of $n$ subjects, explain why it is about $95\%$ likely that the sample proportion has error no more that $1/\sqrt{n}$ in estimating the population proportion. (*Hint*: To show this "$1/\sqrt{n}$ rule", find two standard errors when $\pi=0.50$, and explain how this compares to two standard errors at other values of $\pi$). Using this result, show that $n=1/M^2$ is a safe sample size for estimating a proportion to within $M$ with $95\%$ confidence.

**Solution**

The sampling distribution of the simple random sample $\hat{\pi}$ is approximately normal for large $n$. So the Pivotal Quantity

$$Z=\frac{\hat{\pi}-\pi}{\sqrt{\frac{\pi(1-\pi)}{n}}}$$

has an approximate standard normal distribution. Bounding this between standard normal percentiles, to construct a CI for $\pi$ after observing the simple random sample $\hat{\pi}$.

$$\hat{\pi} -\pi=\pm z_{\alpha/2}\sqrt{\frac{\pi(1-\pi)}{n}}$$
From here we use the simple approximate formula for large $n$ (Wald confidence interval) to easily compute the CI:

$$\hat{\pi}\pm z_{\alpha/2} \sqrt{\frac{\hat{\pi}(1-\hat{\pi})}{n}}$$
So from the exercise we assume the confidence level of $1-\alpha=0.95$ and since $95\%$ of the standard normal distribution falls between $-1.96$ and $1.96$ we have:

$$\hat{\pi}\pm 1.96 \sqrt{\frac{\hat{\pi}(1-\hat{\pi})}{n}}$$
We can observe $1.96\sim2.00$ (the exercise sugestion) and $\sqrt{\hat{\pi}(1-\hat{\pi})}\sim 0.50$ (considering $\hat{\pi}=0.50$) so:

$$\hat{\pi}\pm \frac{1}{\sqrt{n}}$$
And with a simple simulation we can verify that:

```{r}
set.seed(11)
simulation <- 100
size<-100
thresholdrule <- 1/sqrt(size)

standarderror <- function(phi){
y<-rbinom(simulation,size,phi)
p<-y/size
sd <- sqrt(p*(1-p)/size)
return (sd)
}

#standarderror(0.50)
#standarderror(0.10)


all(standarderror(0.50)<thresholdrule)
all(standarderror(0.10)<thresholdrule)

```

Then if we consider the sample size $n=1/M^2$ and at the same time we want $n$ to be able to estimate $\pi$. We have

$$\hat{\pi}\pm M$$


## FSDS - Chapter 5

### Ex 5.2
When a government does not have enough money to pay for the services that it provides, it can raise taxes or it can reduce services. When the Florida Poll asked a random sample of 1200 Floridians which they preferred, 52% (624 of the 1200) chose raise taxes and 48% chose reduce services. Let $\pi$ denote the population proportion of Floridians who would choose raising taxes. Analyze whether this is a minority of the population ($\pi < 0.50$) or a majority ($\pi > 0.50$) by testing $H_0 ∶ \pi = 0.50$ against $H_a: π \ne 0.50$. Interpret the P-value.Is it appropriate to “accept $H_0$? Why or whynot?

**Solution**


### Ex. 5.68
Explain why the confidence interval based on the Wald test of $H_0$: $\theta=\theta_0$ is symmetric around $\hat\theta$ (i.e., having center exactly equal to $\hat\theta$. This is not true for the confidence intervals based on the likelihood-ratio and score tests.) Explain why such symmetry can be problematic when $\theta$ and $\hat\theta$ are near a boundary, using the example of a population proportion that is very close to 0 or 1 and a sample proportion that may well equal 0 or 1.

**Solution**
According to Likelihood theory, the estimators asymptotically follow a normal distribution 
$$
\hat\theta \dot\sim N\Big(\theta,\frac{1}{I(\theta)}\Big)
$$
This implies that
$$
\frac{\hat\theta - \theta}{se}\ \dot\sim\ N(0,1)
$$
Since this statistic is symmetrical with respect to zero, the quantiles are also symmetrical and the confidence intervals are symmetrical around $\hat\theta$ by construction.

With a simulation we can show that for the case of a population proportion, Wald confidence intervals contain the real value for the parameter very few times with respect to the expected amount. **This still does not show why the symmetry of the interval is problematic for certain values. SOLVE!**
```{r}
M<-1000;n<-20; p<-0.95; mat_ci<-matrix(NA,nrow=M,ncol=2)
for(i in 1:M){
  sam <- rbinom(n,1,p)
  phat<-sum(sam)/n
  se_t<-sqrt(phat*(1-phat)/n) * qnorm(0.975)
  mat_ci[i,]<-phat + se_t*c(-1,1)
}
mean(mat_ci[,1]<=p & p<=mat_ci[,2])
```

